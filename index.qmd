---
title: "API d'extraction d'infos de la DSN"
echo: false
---


```{ojs}
liste_codes = d3.json("https://specif-dsn.lab.sspcloud.fr/liste_rubriques")
```

Une extraction bête et méchante du contenu du manuel technique 2024 de la DSN, un magnifique PDF de 400 pages. 

Bientôt de l'IA sur les titres de rubriques et description pour rendre la recherche plus intelligente. Et une plus jolie mise en forme du contenu des rubriques pour rendre ce contenu plus utile. 


```{ojs}
viewof codeDSN = Inputs.text({
  label: "Code technique DSN",
  placeholder: "Entrer un code avec l'aide de l'autocomplétion",
  value: liste_codes['codes'][0],
  datalist: liste_codes['codes']
})
```


```{ojs}
content = d3.json(`https://specif-dsn.lab.sspcloud.fr/check/${codeDSN}`)
```

```{ojs}
markdown_modalite = {
  // 1️⃣ On sécurise l’accès à la donnée
  const modalites = content?.data?.modalites;

  // 2️⃣ On vérifie que c’est un tableau
  if (!Array.isArray(modalites) || modalites.length === 0) {
    return html`<p style="color:#888;">Aucune modalité disponible.</p>`;
  }

  // 3️⃣ On crée les lignes HTML à partir du tableau
  const rows = modalites.map(
    ([code, label]) => html`<tr><td style="text-align:center;">${code}</td><td>${label}</td></tr>`
  );

  // 4️⃣ On assemble le tout dans un tableau stylé
  const tableHTML = html`
    <table style="border-collapse:collapse; width:100%; margin-top:1em; font-family:sans-serif;">
      <caption style="font-weight:bold; padding:0.5em; caption-side:top; text-align:left;">
        Liste des modalités
      </caption>
      <thead style="background:#444; color:white;">
        <tr>
          <th style="text-align:center; padding:0.5em;">Code</th>
          <th style="text-align:left; padding:0.5em;">Libellé</th>
        </tr>
      </thead>
      <tbody>
        ${rows}
      </tbody>
    </table>
  `;

  return tableHTML;
}
```





```{ojs}
md`
 ### ${content.data.nom_champ} (\`${content.data.code}\`)
 
 **Nom technique** : \`${content.data.nom_technique}\`
  
  ${content.data.description}

  ${markdown_modalite}
`
```


```{ojs}
//import {Copier} from "@mbostock/copier"
pbcopy = text => navigator.clipboard.writeText(text)
function Copier(content = "Copy code", options) {
  if (Array.isArray(content)) content = Array.from(content, ([key, value]) => [key, () => (pbcopy(value), value)]);
  return Inputs.button(content, {...options, reduce: (value) => (pbcopy(value), value)});
}
```

```{ojs}
Copier("Copier la sortie en JSON", {value: `${JSON.stringify(content.data, null, 2)}`})
```




